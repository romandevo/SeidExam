<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Basit WebRTC Sesli GÃ¶rÃ¼ÅŸme (P2P)</title>
    <style>
      body {
        font-family: sans-serif;
        max-width: 600px;
        margin: 40px auto;
      }
      textarea {
        width: 100%;
        height: 120px;
      }
      button {
        margin: 10px 0;
        padding: 10px 15px;
      }
    </style>
  </head>
  <body>
    <h2>ğŸ™ï¸ Basit WebRTC Sesli GÃ¶rÃ¼ÅŸme</h2>
    <p>1. Bir cihaz â€œAâ€ (Caller) olsun, diÄŸeri â€œBâ€ (Callee).</p>
    <p>2. A â€œTeklif oluÅŸturâ€a basar, Ã§Ä±kan metni kopyalayÄ±p Bâ€™ye yollar.</p>
    <p>
      3. B â€œTeklifi yapÄ±ÅŸtÄ±râ€a basar, â€œYanÄ±t oluÅŸturâ€ der, Ã§Ä±kan yanÄ±tÄ± Aâ€™ya
      yollar.
    </p>
    <p>4. A â€œYanÄ±tÄ± yapÄ±ÅŸtÄ±râ€a basar â€” baÄŸlantÄ± kurulur!</p>

    <h3>AdÄ±m 1: Teklif / YanÄ±t</h3>
    <textarea id="offer"></textarea><br />
    <button id="makeOffer">Teklif oluÅŸtur</button>
    <button id="setOffer">Teklifi yapÄ±ÅŸtÄ±r</button><br />

    <textarea id="answer"></textarea><br />
    <button id="makeAnswer">YanÄ±t oluÅŸtur</button>
    <button id="setAnswer">YanÄ±tÄ± yapÄ±ÅŸtÄ±r</button>

    <h3>Log:</h3>
    <pre id="log"></pre>

    <script>
      const pc = new RTCPeerConnection();
      const log = msg =>
        (document.getElementById('log').textContent += msg + '\n');

      navigator.mediaDevices
        .getUserMedia({ audio: true })
        .then(stream => {
          pc.addStream(stream);
          const audio = document.createElement('audio');
          audio.autoplay = true;
          pc.onaddstream = e => (audio.srcObject = e.stream);
        })
        .catch(err => log('Mikrofon eriÅŸimi reddedildi: ' + err));

      document.getElementById('makeOffer').onclick = async () => {
        const offer = await pc.createOffer();
        await pc.setLocalDescription(offer);
        document.getElementById('offer').value = JSON.stringify(offer);
        log('Teklif oluÅŸturuldu, kopyala ve karÅŸÄ± tarafa gÃ¶nder.');
      };

      document.getElementById('setOffer').onclick = async () => {
        const offer = JSON.parse(document.getElementById('offer').value);
        await pc.setRemoteDescription(offer);
        log('Teklif alÄ±ndÄ±, ÅŸimdi yanÄ±t oluÅŸturabilirsin.');
      };

      document.getElementById('makeAnswer').onclick = async () => {
        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);
        document.getElementById('answer').value = JSON.stringify(answer);
        log('YanÄ±t oluÅŸturuldu, kopyala ve karÅŸÄ± tarafa gÃ¶nder.');
      };

      document.getElementById('setAnswer').onclick = async () => {
        const answer = JSON.parse(document.getElementById('answer').value);
        await pc.setRemoteDescription(answer);
        log('YanÄ±t alÄ±ndÄ±, baÄŸlantÄ± kuruluyor...');
      };

      pc.onicecandidate = e => {
        if (e.candidate) return; // TÃ¼m adaylar toplanÄ±nca
        if (pc.localDescription.type === 'offer')
          document.getElementById('offer').value = JSON.stringify(
            pc.localDescription
          );
        else
          document.getElementById('answer').value = JSON.stringify(
            pc.localDescription
          );
      };
    </script>
  </body>
</html>
